<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<header> Narrative Visualization: Online Chess Openings by Rating</header>
<body onload='init()'>
    <div id = openings>
        <p>
            <button type="button" onclick="location.href='index.html'">All Openings</button>
            <button type="button" onclick="location.href='index2.html'">Double King Pawn</button>
            <button type="button" onclick="location.href='index3.html'">Sicilian Defense</button>
            <button type="button" onclick="location.href='index4.html'">French Defense</button>
            <button type="button" onclick="location.href='index5.html'">Caro Kann Defense</button>
            <button type="button" onclick="location.href='index5.html'">Non E4 Openings</button>
        </p>
    </div>
<svg width=600 height=600>
</svg>
<script>
async function init() {
const data = await d3.csv("games.csv");

var height = 500
var margin = 50
var width = 500

x = d3.scaleLinear().domain([750,2750]).range([0,width]);
y = d3.scaleLinear().domain([750,2750]).range([height,0]);

// home scene

d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + margin + ")").selectAll().data(data).enter().append("circle")
.attr("cx", function(d,i) { return x(d.white_rating);})
.attr("cy", function(d,i) { return y(d.black_rating);})
.attr("r", function(d,i) { return parseInt(1) + 2;})
.style("fill", function(d) { return color(d); })
.style("fill-opacity", function(d) { return opacity(d); })
.style("stroke-opacity", 0);


d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + margin + ")").call(d3.axisLeft(y).tickValues([1000,1500,2000,2500]))

d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + (margin + height) + ")").call(d3.axisBottom(x).tickValues([1000,1500,2000,2500]))

d3.format("~s")

d3.select("svg").append("text")
    .attr("class", "x label")
    .attr("text-anchor", "end")
    .attr("x", width - 3.5*margin)
    .attr("y", height + 2*margin - 10)
    .text("white rating");

d3.select("svg").append("text")
    .attr("class", "y label")
    .attr("text-anchor", "end")
    .attr("y", 6)
    .attr("x", -260)
    .attr("dy", ".75em")
    .attr("transform", "rotate(-90)")
    .text("black rating");


function color(d) {
    if (isSicilian(d)) {
        return "red"
}
    return "gray"
}

function opacity(d) {
    if (color(d) != "gray") {
        return 0.9
    }
    return 0.5
}


function isSicilian(d) {
    eco = d.opening_eco
    if (eco.charAt(0) == "B" && parseInt(eco.substring(1)) >= 20) {
        return true
    }
    return false
}

function isCaroKann(d) {
    eco = d.opening_eco
    if (eco.charAt(0) == "B" && parseInt(eco.substring(1)) >= 10 && parseInt(eco.substring(1)) <= 19) {
        return true
    }
    return false
}

function isFrench(d) {
    eco = d.opening_eco
    if (eco.charAt(0) == "C" && parseInt(eco.substring(1)) <= 18) {
        return true
    }
    return false
}

function isDoubleKingPawn(d) {
    eco = d.opening_eco
    if (eco.charAt(0) == "C" && parseInt(eco.substring(1)) >= 20) {
        return true
    }
    return false
}

function isDoubleQueenPawn(d) {
    eco = d.opening_eco
    if (eco.charAt(0) == "D" && parseInt(eco.substring(1)) <= 60) {
        return true
    }
    return false
}

}
</script>
</body>
</html>